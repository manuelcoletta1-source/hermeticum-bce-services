<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Validatore ex-ante IPR — IPR Europeo</title>
  <meta name="description" content="Validatore ex-ante IPR Europeo. Fail-closed, hash-only, auditabile. Determina l’ammissibilità tecnica di un’azione prima dell’esecuzione." />
  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0b0f14; color:#e6edf3; }
    a { color:#9cd1ff; text-decoration:none; }
    a:hover { text-decoration:underline; }
    .wrap { max-width: 1080px; margin: 0 auto; padding: 26px 16px; }

    header { display:flex; justify-content:space-between; align-items:flex-start; gap:14px; padding-bottom:12px; border-bottom:1px solid rgba(255,255,255,.12); flex-wrap:wrap; }
    .brand { font-size:14px; line-height:1.4; }
    nav { display:flex; gap:10px; flex-wrap:wrap; }
    .pill { border:1px solid rgba(255,255,255,.14); padding:8px 10px; border-radius:999px; font-size:12px; background:rgba(255,255,255,.03); }

    h1 { margin:18px 0 6px; font-size:26px; }
    p { line-height:1.55; opacity:.9; font-size:14px; }
    .badges { display:flex; gap:8px; flex-wrap:wrap; margin:10px 0; }
    .badge { border:1px solid rgba(255,255,255,.14); padding:3px 8px; border-radius:999px; font-size:11px; background:rgba(255,255,255,.03); }

    .grid { display:grid; grid-template-columns: 1fr; gap:14px; margin-top:14px; }
    @media (min-width: 900px){ .grid { grid-template-columns: 1fr 1fr; } }

    .card { border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.02); border-radius:14px; padding:14px; }
    .card h2 { margin:0 0 8px; font-size:16px; }
    textarea { width:100%; min-height:180px; background:#0a0e13; color:#e6edf3; border:1px solid rgba(255,255,255,.18); border-radius:12px; padding:10px; font-family: ui-monospace, monospace; font-size:12px; }
    button { border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.08); color:#e6edf3; padding:10px 14px; border-radius:12px; font-size:13px; cursor:pointer; }
    button:hover { background:rgba(255,255,255,.12); }

    .result { margin-top:14px; padding:14px; border-radius:14px; border:1px solid rgba(255,255,255,.18); }
    .ok { border-color:#3fb950; background:rgba(63,185,80,.08); }
    .ko { border-color:#f85149; background:rgba(248,81,73,.08); }

    pre { background:#0a0e13; padding:10px; border-radius:12px; overflow:auto; font-size:12px; }
    footer { margin-top:26px; padding-top:14px; border-top:1px solid rgba(255,255,255,.12); font-size:12px; opacity:.75; display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; }
  </style>
</head>

<body>
<div class="wrap">

  <!-- NAV -->
  <header>
    <div class="brand">
      <b>IPR Europeo</b><br/>
      Validatore ex-ante
    </div>
    <nav>
      <a class="pill" href="../">Home</a>
      <a class="pill" href="../ipr/">IPR</a>
      <a class="pill" href="../verify/">Validatore</a>
      <a class="pill" href="../specs/">Specifiche</a>
      <a class="pill" href="../audit/">Audit</a>
      <a class="pill" href="../status/">Status</a>
    </nav>
  </header>

  <!-- HERO -->
  <h1>Validatore ex-ante IPR</h1>
  <p>
    Questo strumento determina se un’azione digitale è <b>ammissibile prima
    dell’esecuzione</b>, secondo lo standard IPR Europeo.
  </p>

  <div class="badges">
    <span class="badge">FAIL-CLOSED</span>
    <span class="badge">HASH-ONLY</span>
    <span class="badge">OFFLINE</span>
    <span class="badge">AUDITABLE</span>
  </div>

  <!-- INPUT -->
  <div class="grid">
    <div class="card">
      <h2>Action Request</h2>
      <p>Descrive l’azione proposta.</p>
      <textarea id="action">
{
  "action_id": "ACT-001",
  "action_type": "APPLY_MEASURE",
  "context": "high_criticality_control",
  "timestamp": "2026-02-03T15:20:00Z"
}
      </textarea>
    </div>

    <div class="card">
      <h2>Responsibility Declaration</h2>
      <p>Dichiara l’attribuzione e la decisione umana.</p>
      <textarea id="resp">
{
  "subject_id": "HUM-001",
  "role": "AUTHORIZED_OFFICER",
  "decision": "Approve measure",
  "decision_timestamp": "2026-02-03T15:19:00Z"
}
      </textarea>
    </div>
  </div>

  <div style="margin-top:14px;">
    <button onclick="validate()">Validate ex-ante</button>
  </div>

  <!-- RESULT -->
  <div id="output"></div>

  <!-- FOOTER -->
  <footer>
    <div>
      Validatore ex-ante IPR — standard tecnologico europeo<br/>
      Implementazione di riferimento: HERMETICUM B.C.E. S.r.l.
    </div>
    <div>
      <a href="../privacy/">Privacy</a> · <a href="../terms/">Terms</a>
    </div>
  </footer>

</div>

<script>
async function sha512(str){
  const buf = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest('SHA-512', buf);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

async function validate(){
  const out = document.getElementById('output');
  out.innerHTML = '';

  let action, resp;
  try {
    action = JSON.parse(document.getElementById('action').value);
    resp = JSON.parse(document.getElementById('resp').value);
  } catch(e){
    out.innerHTML = `<div class="result ko"><b>DENIED</b><p>Invalid JSON</p></div>`;
    return;
  }

  const missing = [];
  if(!action.action_id) missing.push("action_id");
  if(!action.action_type) missing.push("action_type");
  if(!resp.subject_id) missing.push("subject_id");
  if(!resp.decision) missing.push("decision");
  if(!resp.decision_timestamp) missing.push("decision_timestamp");

  if(missing.length){
    out.innerHTML = `<div class="result ko"><b>DENIED</b><p>Missing fields: ${missing.join(', ')}</p></div>`;
    return;
  }

  const preimage = JSON.stringify({action, resp});
  const digest = await sha512(preimage);

  const evidence = {
    schema: "IPR-EVIDENCE-v1",
    status: "AUTHORIZED",
    hash_algorithm: "SHA-512",
    digest_hex: digest,
    timestamp: new Date().toISOString(),
    verifiable_independently: true
  };

  out.innerHTML = `
    <div class="result ok">
      <b>AUTHORIZED</b>
      <p>L’azione è tecnicamente ammissibile ex-ante.</p>
      <pre>${JSON.stringify(evidence, null, 2)}</pre>
    </div>
  `;
}
</script>

</body>
</html>
