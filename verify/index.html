<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>HERMETICUM — Verify</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="HERMETICUM verification — hash checks + receipt validation + disclosure of declared identity/location and AI interface metadata.">

  <style>
    :root{--bg:#0b0d10;--card:#0f1318;--text:#e7edf5;--muted:#9fb0c2;--line:rgba(255,255,255,.12);--soft:rgba(255,255,255,.06);--max:1100px}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.45}
    a{color:inherit;text-decoration:none} a:hover{text-decoration:underline}
    .wrap{max-width:var(--max);margin:0 auto;padding:0 16px}

    .nav{border-bottom:1px solid var(--line);background:rgba(0,0,0,.2);backdrop-filter:blur(6px)}
    .nav-inner{max-width:var(--max);margin:0 auto;padding:14px 16px;display:flex;justify-content:space-between;align-items:center;gap:16px}
    .brand{font-weight:800;letter-spacing:.8px}
    .nav-links{display:flex;gap:12px;font-size:14px;color:var(--muted);flex-wrap:wrap}
    .nav-links a{padding:6px 8px;border-radius:10px}
    .nav-links a:hover{background:var(--soft);color:var(--text);text-decoration:none}

    .policy{border-bottom:1px solid var(--line);background:rgba(255,255,255,.03);font-size:13px;color:var(--muted);padding:10px 16px}

    main{padding:32px 0}
    .hero h1{margin:0 0 10px;font-size:26px;line-height:1.15}
    .hero p{margin:0;max-width:92ch;color:var(--muted)}

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;margin-top:24px}
    .card{grid-column:span 12;background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
    @media(min-width:900px){.half{grid-column:span 6}}

    label{display:block;font-size:13px;color:var(--muted);margin-top:10px}
    input,textarea{
      width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);
      background:rgba(0,0,0,.22);color:var(--text);font-size:14px;outline:none
    }
    textarea{min-height:160px;resize:vertical}

    .btn{margin-top:12px;padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.03);font-size:14px;cursor:pointer}
    .btn:hover{background:rgba(255,255,255,.06)}

    .out{margin-top:10px;padding:14px;border-radius:12px;border:1px solid var(--line);background:rgba(0,0,0,.18);font-family:ui-monospace,monospace;font-size:13px;white-space:pre-line;overflow:auto}
    .hint{font-size:12px;color:var(--muted);margin-top:8px}

    footer{border-top:1px solid var(--line);background:rgba(0,0,0,.18);padding:22px 0 26px;color:var(--muted)}
    .footer-inner{max-width:var(--max);margin:0 auto;padding:0 16px}
    .mini{font-size:13px;opacity:.9}
    .sig{margin-top:18px;font-size:12px;opacity:.6;letter-spacing:.4px}
  </style>
</head>

<body>

<nav class="nav">
  <div class="nav-inner">
    <div class="brand">HERMETICUM</div>
    <div class="nav-links">
      <a href="../">Home</a>
      <a href="../architecture/">Architecture</a>
      <a href="../use-cases/">Use-Cases</a>
      <a href="../create/">Create</a>
      <a href="../verify/">Verify</a>
      <a href="../audit/">Audit</a>
      <a href="../eu/pilot/">EU Pilot</a>
      <a href="../company/">Company</a>
    </div>
  </div>
</nav>

<div class="policy"><div class="wrap">Audit-first · Fail-closed · Hash-only · No data custody</div></div>

<main class="wrap">
  <section class="hero">
    <h1>Verifica</h1>
    <p>
      Verifica deterministica: formato hash + receipt SHA-256 per artefatti JSON.
      Disclosure tecnica (best-effort): identity/location self-declared e metadati AI (se presenti).
    </p>
  </section>

  <section class="grid">
    <div class="card half">
      <h2>1) Verifica formato hash</h2>

      <label>Hash / Reference</label>
      <input id="hash" placeholder="hash / reference (hex)">

      <button class="btn" onclick="checkHash()">Verifica hash</button>
      <div id="hashOut" class="out">STATO: IDLE</div>

      <div class="hint">Hex 32–128 caratteri (0x opzionale).</div>
    </div>

    <div class="card half">
      <h2>2) Verifica receipt SHA-256 (JSON)</h2>

      <label>Artifact JSON (incolla qui)</label>
      <textarea id="json" placeholder="{ ... }"></textarea>

      <label>Receipt atteso (SHA-256 del JSON)</label>
      <input id="receipt" placeholder="receipt_sha256(json)">

      <button class="btn" onclick="checkReceipt()">Verifica receipt</button>
      <div id="receiptOut" class="out">STATO: IDLE</div>

      <div class="hint">
        Se payload presente → PRIVATE. Il sistema non invia né conserva nulla.
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="footer-inner">
    <div class="mini">HERMETICUM — digital responsibility infrastructure</div>
    <div class="sig">HERMETICUM B.C.E. S.r.l. · EU</div>
  </div>
</footer>

<script>
function isHexHash(s){
  const t = (s||"").trim().replace(/^0x/,'');
  return /^[a-fA-F0-9]{32,128}$/.test(t);
}
function normalizeHex(s){ return (s||"").trim().toLowerCase().replace(/^0x/,''); }

async function sha256String(text){
  const bytes = new TextEncoder().encode(text);
  const buf = await crypto.subtle.digest("SHA-256", bytes);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

function checkHash(){
  const v = document.getElementById("hash").value.trim();
  const out = document.getElementById("hashOut");
  if(!v) return out.textContent = "STATO: FAIL\nMOTIVO: input mancante";
  if(!isHexHash(v)) return out.textContent = "STATO: FAIL\nMOTIVO: formato non valido";
  out.textContent = "STATO: PASS\nFORMAT: OK\nHASH:\n" + normalizeHex(v);
}

function safeGet(obj, path, fallback){
  try{
    return path.split('.').reduce((o,k)=> (o && (k in o)) ? o[k] : undefined, obj) ?? fallback;
  }catch(e){
    return fallback;
  }
}

async function checkReceipt(){
  const jsonText = (document.getElementById("json").value || "").trim();
  const receipt = (document.getElementById("receipt").value || "").trim();
  const out = document.getElementById("receiptOut");

  if(!jsonText) return out.textContent = "STATO: FAIL\nMOTIVO: JSON mancante";
  if(!receipt)  return out.textContent = "STATO: FAIL\nMOTIVO: receipt mancante";
  if(!isHexHash(receipt)) return out.textContent = "STATO: FAIL\nMOTIVO: receipt formato non valido";

  let payloadMode = "UNKNOWN";
  let privacy = "UNKNOWN";
  let ai = "OFF";
  let aiMode = "N/A";
  let aiAvail = "N/A";

  let idName = "N/A";
  let idNation = "N/A";
  let locCountry = "N/A";
  let locRegion = "N/A";
  let locCity = "N/A";
  let locZone = "N/A";
  let locGran = "N/A";

  try{
    const obj = JSON.parse(jsonText);

    payloadMode = safeGet(obj, "payload.mode", "UNKNOWN");
    privacy =
      (payloadMode === "FILE" || payloadMode === "TEXT") ? "PRIVATE (contiene payload)"
      : (payloadMode === "NONE") ? "PUBLIC (senza payload)"
      : "UNKNOWN";

    // identity + location (self-declared)
    idName = safeGet(obj, "declared_identity.name", "N/A");
    idNation = safeGet(obj, "declared_identity.nation", "N/A");
    locCountry = safeGet(obj, "declared_identity.location.country", idNation || "N/A");
    locRegion  = safeGet(obj, "declared_identity.location.region", "N/A");
    locCity    = safeGet(obj, "declared_identity.location.city", "N/A");
    locZone    = safeGet(obj, "declared_identity.location.zone", "N/A");
    locGran    = safeGet(obj, "declared_identity.location.granularity", "N/A");

    // ai
    if(safeGet(obj, "ai_interface.enabled", false) === true){
      ai = "ON";
      aiMode = safeGet(obj, "ai_interface.mode", "N/A");
      aiAvail = safeGet(obj, "ai_interface.availability", "N/A");
    }
  }catch(e){
    // best-effort parse only
  }

  const computed = await sha256String(jsonText);
  const exp = normalizeHex(receipt);

  if(computed !== exp){
    return out.textContent =
      "STATO: FAIL\nMOTIVO: receipt non corrisponde\n\n" +
      "EXPECTED:\n" + exp + "\n\n" +
      "COMPUTED:\n" + computed + "\n\n" +
      "ARTIFACT:\n" + privacy + "\n" +
      "AI_INTERFACE:\n" + ai;
  }

  out.textContent =
    "STATO: PASS\nRECEIPT: OK\nCOMPUTED:\n" + computed + "\n\n" +
    "ARTIFACT:\n" + privacy + "\n\n" +
    "DECLARED IDENTITY:\n" +
    "Name: " + idName + "\n" +
    "Nation: " + idNation + "\n\n" +
    "DECLARED LOCATION (LOW GRANULARITY):\n" +
    "Country: " + locCountry + "\n" +
    "Region: " + locRegion + "\n" +
    "City: " + locCity + "\n" +
    "Zone: " + locZone + "\n" +
    "Granularity: " + locGran + "\n\n" +
    "AI_INTERFACE:\n" + ai + "\n" +
    "AI_AVAILABILITY:\n" + aiAvail + "\n" +
    "AI_MODE:\n" + aiMode;
}
</script>

</body>
</html>
