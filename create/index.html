<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create | HERMETICUM B.C.E.</title>
  <meta name="description" content="Generatore locale di Evidence Bundle (minimo). Hash-only, GDPR-min. Output verificabile in Verify." />
  <link rel="stylesheet" href="../assets/css/main.css" />
</head>
<body>
  <header class="wrap">
    <nav class="nav">
      <a class="brand" href="../">HERMETICUM - BLINDATA · COMPUTABILE · EVOLUTIVA</a>
      <div class="navlinks">
        <a href="../standards/">Standard</a>
        <a href="../research/">Ricerca (Horizon)</a>
        <a href="../phase-1/">Fase 1 (ONLY)</a>
        <a href="../verify/">Verify</a>
        <a href="../governance/">Governance</a>
        <a href="../privacy/">Privacy</a>
      </div>
    </nav>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1>Create (Evidence Bundle)</h1>
      <p class="lead">
        Genera un <strong>Evidence Bundle</strong> minimo nel browser.
        Nessun account. Nessuna custodia PII. Output: JSON verificabile in Verify.
      </p>
      <div class="notice">
        <strong>Fail-closed:</strong> se mancano campi minimi (HRR, POLICY, PAYLOAD_MIN), il bundle è INVALID.
      </div>
    </section>

    <section class="grid">
      <article class="card">
        <h2>Input minimi</h2>

        <label class="muted">HRR (da Onboarding LIGHT/STRONG)</label>
        <input id="hrr" type="text" placeholder="es. HRR-L-.... oppure HRR-S-...." />

        <label class="muted" style="margin-top:10px;">Descrizione (breve, no PII)</label>
        <input id="desc" type="text" placeholder="es. Evidence bundle per audit tecnico (senza dati personali)" />

        <label class="muted" style="margin-top:10px;">Hash del contenuto (opzionale ma consigliato)</label>
        <input id="hash" type="text" placeholder="es. SHA-256 hex (64 chars)" />

        <label class="muted" style="margin-top:10px;">Timestamp (opzionale)</label>
        <input id="ts" type="text" placeholder="es. 2026-01-27T20:00:00Z" />

        <div class="btnrow" style="margin-top:14px;">
          <button class="btn" id="gen">Genera Bundle</button>
          <button class="btn secondary" id="reset">Reset</button>
          <a class="btn secondary" href="../verify/">Vai a Verify</a>
        </div>
      </article>

      <article class="card">
        <h2>Output (JSON)</h2>
        <pre id="out" class="codeblock">Pronto.</pre>
        <div class="btnrow">
          <button class="btn secondary" id="copyBtn" type="button">Copia</button>
          <a class="btn secondary" href="../">Torna al Gateway</a>
        </div>
      </article>

      <article class="card">
        <h2>Policy</h2>
        <p class="muted">Stringa policy consigliata:</p>
        <pre class="codeblock">UE-first | GDPR-min | hash-only | append-only | fail-closed</pre>
        <p class="muted">
          La definizione dei livelli sta in <a href="../standards/">Standard</a>.
        </p>
      </article>

      <article class="card">
        <h2>Nota</h2>
        <p class="muted">
          Questo tool non pubblica nulla. Genera un bundle locale.
          La pubblicazione/ancoraggio (se previsto) avviene nel livello operativo e fuori da questo portale statico.
        </p>
      </article>
    </section>
  </main>

  <footer class="wrap foot">
    <small>HERMETICUM B.C.E. S.r.l.</small>
  </footer>

<script>
  const out = document.getElementById("out");
  const copyBtn = document.getElementById("copyBtn");

  function isHex(s){ return /^[0-9a-fA-F]+$/.test(s); }
  function looksLikeSha256(h){ return typeof h==="string" && h.length===64 && isHex(h); }

  function fail(reason, extra){
    out.textContent = JSON.stringify({ status:"INVALID", reason, ...extra, ts_utc:new Date().toISOString() }, null, 2);
  }

  document.getElementById("gen").addEventListener("click", () => {
    const HRR = (document.getElementById("hrr").value || "").trim();
    const DESC = (document.getElementById("desc").value || "").trim();
    const HASH = (document.getElementById("hash").value || "").trim();
    const TS = (document.getElementById("ts").value || "").trim();

    if (!HRR) return fail("Missing HRR");
    if (!DESC) return fail("Missing description");

    if (HASH && !looksLikeSha256(HASH)){
      return fail("Hash present but not SHA-256 hex", { hash_len: HASH.length });
    }

    const bundle = {
      HRR,
      POLICY: "UE-first | GDPR-min | hash-only | append-only | fail-closed",
      NOTE: "Generated locally in browser. Not an identity proof.",
      PAYLOAD_MIN: {
        desc: DESC,
        content_hash_sha256: HASH || null,
        timestamp: TS || null,
        created_utc: new Date().toISOString()
      }
    };

    out.textContent = JSON.stringify({ status:"VALID", bundle }, null, 2);
  });

  document.getElementById("reset").addEventListener("click", () => {
    document.getElementById("hrr").value = "";
    document.getElementById("desc").value = "";
    document.getElementById("hash").value = "";
    document.getElementById("ts").value = "";
    out.textContent = "Pronto.";
  });

  copyBtn.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(out.textContent);
      copyBtn.textContent = "Copiato";
      setTimeout(() => (copyBtn.textContent = "Copia"), 900);
    } catch {}
  });
</script>
</body>
</html>
