<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Create / Output — HERMETICUM B.C.E.</title>
  <meta name="description" content="Output IPR: scarica manifest, conserva evidenze, passa a Verify. Fail-closed." />
  <style>
    :root{--bg:#0b0f14;--card:#0f1620;--muted:#9fb0c3;--text:#e9f1fb;--line:#1b2735;--accent:#7dd3fc;--warn:#fde68a;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:15px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial}
    a{color:inherit}
    .wrap{max-width:980px;margin:0 auto;padding:22px 16px}
    .nav{display:flex;gap:10px;flex-wrap:wrap;border:1px solid var(--line);background:rgba(255,255,255,.02);padding:12px 14px;border-radius:16px}
    .pill{border:1px solid var(--line);background:rgba(255,255,255,.02);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:12px}
    .card{border:1px solid var(--line);background:var(--card);border-radius:18px;padding:14px;margin-top:12px}
    h1{margin:14px 0 6px;font-size:22px}
    p{margin:0 0 10px;color:var(--muted)}
    pre{margin:10px 0 0;padding:12px;border-radius:16px;border:1px solid var(--line);background:rgba(0,0,0,.18);overflow:auto;color:var(--text);font-size:12px}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button, .btn{
      border:1px solid var(--line); background:rgba(255,255,255,.03); color:var(--text);
      padding:10px 12px; border-radius:14px; cursor:pointer; text-decoration:none; display:inline-flex;align-items:center;gap:8px;
    }
    .btn.primary{border-color:rgba(125,211,252,.35);background:rgba(125,211,252,.10)}
    .mini{font-size:12px;color:var(--muted)}
    .warn{color:var(--warn)}
    footer{margin-top:14px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="nav">
      <span class="pill"><a href="../verify/">Verifica ora</a></span>
      <span class="pill"><a href="../evidence/">Evidence</a></span>
      <span class="pill"><a href="../terms/">Termini</a></span>
      <span class="pill"><a href="../">Home</a></span>
      <span class="pill">fail-closed</span>
    </div>

    <h1>IPR rilasciato — Output</h1>
    <p>Salva → conserva → verifica. Se qualcosa manca o non torna → <b>fail-closed</b>. 5</p>

    <div class="card">
      <h2 style="margin:0 0 8px;font-size:16px">Manifest IPR</h2>
      <p id="status" class="mini warn">Caricamento manifest dal browser…</p>
      <pre id="manifest">{ }</pre>

      <div class="btns">
        <a class="btn primary" href="../verify/">Verifica IPR</a>
        <button id="btnDownloadJson">Scarica (.json)</button>
        <button id="btnDownloadTxt">Scarica (.txt)</button>
        <button id="btnCopy">Copia</button>
        <button id="btnClear">Pulisci dal browser</button>
      </div>

      <div class="mini" style="margin-top:10px">
        Buona pratica: conserva anche esito di verifica + versioning/changelog (vedi Evidence). 6
      </div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px;font-size:16px">Checklist conservazione (rapida)</h2>
      <ul class="mini" style="margin:0;padding-left:16px">
        <li><b>BASE</b>: manifest salvato + data/ora rilascio + file originali (se usati).</li>
        <li><b>STRONG</b>: hash ricalcolati localmente + esito Verify registrato + versioning.</li>
        <li><b>ENTERPRISE</b>: policy conservazione + ruoli + catena di custodia + audit trail.</li>
      </ul>
    </div>

    <footer>
      <div style="margin-top:14px">
        <b>HERMETICUM B.C.E.</b><br/>
        HERMETICUM - BLINDATA · COMPUTABILE · EVOLUTIVA<br/>
        HERMETICUM B.C.E. S.r.l.
      </div>
      <div class="mini" style="margin-top:8px">Platform status: Experimental · Jurisdiction: EU</div>
    </footer>
  </div>

  <script>
    const KEY = "HBCE_IPR_MANIFEST";
    const elMan = document.getElementById("manifest");
    const elStatus = document.getElementById("status");
    let manifestText = "";

    function load(){
      const raw = localStorage.getItem(KEY);
      if(!raw){
        elStatus.textContent = "FAIL-CLOSED: nessun manifest trovato nel browser. Torna su Create e rigenera.";
        elMan.textContent = "{ }";
        return;
      }
      try{
        const obj = JSON.parse(raw);
        manifestText = JSON.stringify(obj, null, 2);
        elMan.textContent = manifestText;
        elStatus.textContent = "OK: manifest caricato dal browser (localStorage). Ora scarica e conserva.";
      }catch(e){
        elStatus.textContent = "FAIL-CLOSED: manifest corrotto/non JSON. Rigenera da Create.";
        elMan.textContent = "{ }";
      }
    }

    function download(filename, text){
      const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    document.getElementById("btnDownloadJson").addEventListener("click", ()=>{
      if(!manifestText) return;
      download("IPR-manifest.json", manifestText);
    });

    document.getElementById("btnDownloadTxt").addEventListener("click", ()=>{
      if(!manifestText) return;
      download("IPR-manifest.txt", manifestText);
    });

    document.getElementById("btnCopy").addEventListener("click", async ()=>{
      if(!manifestText) return;
      await navigator.clipboard.writeText(manifestText);
      elStatus.textContent = "OK: copiato negli appunti.";
    });

    document.getElementById("btnClear").addEventListener("click", ()=>{
      localStorage.removeItem(KEY);
      localStorage.removeItem("HBCE_IPR_CONTENT");
      elStatus.textContent = "Pulito dal browser. (Se serve, rigenera da Create.)";
      elMan.textContent = "{ }";
      manifestText = "";
    });

    load();
  </script>
</body>
</html>
