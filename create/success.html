<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPR Rilasciato — HERMETICUM B.C.E.</title>
  <meta name="description" content="Output post-rilascio IPR: salva manifest, conserva evidenze, avvia verifica (fail-closed).">
  <style>
    body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;background:#0b0b0b;color:#e6e6e6;line-height:1.6}
    header,section{max-width:1100px;margin:auto;padding:2.5rem 1rem}
    header{padding-top:3.5rem}
    h1{font-size:2.1rem;margin:0 0 .5rem}
    .sub{opacity:.85}
    .badge{display:inline-block;border:1px solid #444;border-radius:999px;padding:.15rem .6rem;font-size:.85rem;opacity:.9}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.2rem;margin-top:1.5rem}
    .card{border:1px solid #222;background:#111;border-radius:6px;padding:1.25rem}
    a{color:#9ad}
    .cta{display:inline-block;margin:.5rem .4rem 0 0;padding:.7rem 1.1rem;border:1px solid #444;border-radius:4px;color:#fff;text-decoration:none;font-weight:500}
    .cta.primary{border-color:#888}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    textarea{width:100%;min-height:240px;background:#0f0f0f;color:#e6e6e6;border:1px solid #222;border-radius:6px;padding:12px;box-sizing:border-box}
    .row{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.75rem}
    button{background:#111;color:#fff;border:1px solid #444;border-radius:4px;padding:.65rem 1rem;cursor:pointer;font-weight:600}
    button.primary{border-color:#888}
    .hint{opacity:.85;font-size:.95rem}
    .warn{opacity:.9}
    .line{height:1px;background:#222;margin:1.2rem 0}
    .pill{display:inline-block;border:1px solid #333;border-radius:999px;padding:.25rem .65rem;font-size:.85rem;opacity:.9}
  </style>
</head>
<body>

<header>
  <div class="badge">Create / Output</div>
  <h1>IPR rilasciato</h1>
  <p class="sub">
    Output post-rilascio: <strong>salva</strong> → <strong>conserva</strong> → <strong>verifica</strong>.
    In dubbio → <strong>fail-closed</strong>.
  </p>

  <div style="margin-top:1rem;">
    <a class="cta primary" href="../verify/">Verifica ora</a>
    <a class="cta" href="../evidence/">Evidence</a>
    <a class="cta" href="../terms/">Termini</a>
    <a class="cta" href="../">Home</a>
  </div>
</header>

<section>
  <h2>Esito</h2>
  <div class="grid">
    <div class="card">
      <h3>Stato</h3>
      <div class="pill" id="statePill">—</div>
      <p class="hint" id="stateMsg">Caricamento manifest…</p>
    </div>

    <div class="card">
      <h3>Cosa fare adesso</h3>
      <ol>
        <li>Scarica il manifest</li>
        <li>Conserva file/evidenze in modo coerente</li>
        <li>Vai a <a href="../verify/">Verifica IPR</a></li>
      </ol>
    </div>

    <div class="card">
      <h3>Perimetro</h3>
      <p class="warn">
        Questo output è <strong>tecnico</strong>. Non è identità legale, non è firma qualificata,
        non produce effetti automatici.
      </p>
    </div>
  </div>
</section>

<section>
  <h2>Manifest IPR</h2>
  <p class="sub">
    Il manifest viene caricato automaticamente dal browser (<span class="mono">localStorage</span>) se disponibile.
    Puoi anche incollarlo manualmente.
  </p>

  <div class="card">
    <textarea id="manifest" placeholder="Incolla qui il tuo manifest IPR..."></textarea>

    <div class="row">
      <button class="primary" id="downloadJson">Scarica (.json)</button>
      <button id="downloadTxt">Scarica (.txt)</button>
      <button id="saveLocal">Salva nel browser</button>
      <button id="clearAll">Pulisci</button>
    </div>

    <div class="line"></div>

    <p class="hint">
      Buona pratica: conserva anche <strong>output di verifica</strong> e versioni (vedi <a href="../evidence/">Evidence</a>).
    </p>
  </div>
</section>

<section>
  <h2>Checklist conservazione</h2>
  <div class="grid">
    <div class="card">
      <h3>BASE</h3>
      <ul>
        <li>Manifest salvato</li>
        <li>Data/ora del rilascio</li>
        <li>File originali (se usati)</li>
      </ul>
    </div>

    <div class="card">
      <h3>STRONG (audit)</h3>
      <ul>
        <li>Manifest + evidenze</li>
        <li>Hash ricalcolati localmente</li>
        <li>Esito verifica registrato</li>
        <li>Versioning/changelog</li>
      </ul>
    </div>

    <div class="card">
      <h3>ENTERPRISE</h3>
      <ul>
        <li>Policy conservazione</li>
        <li>Ruoli e responsabilità</li>
        <li>Catena di custodia</li>
        <li>Audit trail completo</li>
      </ul>
    </div>
  </div>
</section>

<footer style="margin-top:4rem;padding:2rem 1rem;border-top:1px solid #222;font-size:0.9rem;opacity:0.85;">
  <div style="max-width:1100px;margin:auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1rem;">
    <div>
      <strong>HERMETICUM B.C.E.</strong><br>
      HERMETICUM - BLINDATA · COMPUTABILE · EVOLUTIVA<br>
      <span class="sub">HERMETICUM B.C.E. S.r.l.</span>
    </div>
    <div>
      <a href="../legal/privacy.html">Privacy</a><br>
      <a href="../legal/cookies.html">Cookies</a><br>
      <a href="../legal/accessibility.html">Accessibility</a>
    </div>
    <div>
      <a href="../legal/legal-notice.html">Legal notice</a><br>
      <a href="../legal/contact.html">Contact</a>
    </div>
    <div>
      Platform status: <strong>Experimental</strong><br>
      Jurisdiction: <strong>EU</strong>
    </div>
  </div>
</footer>

<script>
  const el = document.getElementById("manifest");
  const pill = document.getElementById("statePill");
  const msg  = document.getElementById("stateMsg");

  function setState(label, text) {
    pill.textContent = label;
    msg.textContent = text || "";
  }

  function download(filename, content, mime) {
    const blob = new Blob([content], { type: mime || "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 2500);
  }

  function loadLocal() {
    try {
      const saved = localStorage.getItem("hbce_ipr_manifest");
      if (saved && saved.trim().length > 0) {
        el.value = saved;
        setState("READY", "Manifest caricato dal browser. Procedi con download o verifica.");
      } else {
        setState("EMPTY", "Nessun manifest trovato nel browser. Incolla manualmente o torna a Create.");
      }
    } catch (e) {
      setState("ERROR", "Impossibile accedere a localStorage nel browser corrente.");
    }
  }

  // Autoload
  loadLocal();

  document.getElementById("downloadJson").addEventListener("click", () => {
    const txt = el.value.trim();
    if (!txt) return alert("Manifest vuoto: incolla o carica dal browser.");
    download("ipr-manifest.json", txt, "application/json;charset=utf-8");
  });

  document.getElementById("downloadTxt").addEventListener("click", () => {
    const txt = el.value.trim();
    if (!txt) return alert("Manifest vuoto: incolla o carica dal browser.");
    download("ipr-manifest.txt", txt, "text/plain;charset=utf-8");
  });

  document.getElementById("saveLocal").addEventListener("click", () => {
    const txt = el.value.trim();
    if (!txt) return alert("Manifest vuoto: incolla prima il manifest.");
    localStorage.setItem("hbce_ipr_manifest", txt);
    localStorage.setItem("hbce_ipr_saved_at", new Date().toISOString());
    setState("SAVED", "Manifest salvato nel browser.");

    if (confirm("Manifest salvato. Vuoi verificare subito l’IPR?")) {
      window.location.href = "../verify/";
    }
  });

  document.getElementById("clearAll").addEventListener("click", () => {
    try { localStorage.removeItem("hbce_ipr_manifest"); } catch(e){}
    el.value = "";
    setState("EMPTY", "Pulito. Nessun manifest presente.");
  });
</script>

</body>
</html>
