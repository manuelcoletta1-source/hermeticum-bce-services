<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Onboarding LIGHT | Fase 1 (ONLY) — HERMETICUM B.C.E.</title>
  <meta name="description" content="Onboarding LIGHT: GDPR-min, nessun account, nessuna custodia PII. Dati minimi e controllo locale." />
  <link rel="stylesheet" href="../../assets/css/main.css" />
</head>
<body>
  <header class="wrap">
    <nav class="nav">
      <a class="brand" href="../../">HERMETICUM - BLINDATA · COMPUTABILE · EVOLUTIVA</a>
      <div class="navlinks">
        <a href="../../standards/">Standard</a>
        <a href="../../research/">Ricerca</a>
        <a class="active" href="../">Fase 1</a>
        <a href="../../verify/">Verify</a>
        <a href="../../governance/">Governance</a>
        <a href="../../privacy/">Privacy</a>
      </div>
    </nav>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1>Onboarding LIGHT</h1>
      <p class="lead">
        Profilo minimo. Nessun account. Nessuna custodia di dati personali lato portale.
        L’obiettivo è produrre un <strong>HRR pseudonimo</strong> e una ricevuta locale.
      </p>
      <div class="notice">
        <strong>GDPR-min:</strong> compila solo ciò che è necessario.
        Email opzionale (solo notifica). Nessun telefono in LIGHT.
      </div>
    </section>

    <section class="grid">
      <article class="card">
        <h2>Dati minimi (consigliati)</h2>

        <form id="lightForm">
          <label class="muted">Email (opzionale, solo notifica)</label>
          <input id="email" type="email" placeholder="email@dominio.eu" />

          <label class="muted" style="margin-top:10px;">Paese</label>
          <input id="country" type="text" placeholder="Italia" required />

          <label class="muted" style="margin-top:10px;">Regione</label>
          <input id="region" type="text" placeholder="Piemonte" required />

          <label class="muted" style="margin-top:10px;">Città</label>
          <input id="city" type="text" placeholder="Torino" required />

          <label class="muted" style="margin-top:10px;">Zona / Quartiere</label>
          <input id="zone" type="text" placeholder="Quartiere (senza via)" required />

          <label class="muted" style="margin-top:10px;">Consenso minimizzazione (obbligatorio)</label>
          <div class="muted">
            <input id="consent" type="checkbox" required />
            <span>Confermo di voler minimizzare i dati e di non inserire PII non necessarie.</span>
          </div>

          <div class="btnrow" style="margin-top:14px;">
            <button class="btn" type="submit">Genera HRR (locale)</button>
            <a class="btn secondary" href="../">Torna a Fase 1</a>
          </div>
        </form>
      </article>

      <article class="card">
        <h2>Output (locale)</h2>
        <p class="muted">
          Questo portale statico genera l’output nel browser. Copia/incolla o salva.
        </p>
        <pre id="out" class="codeblock">Compila il form e genera.</pre>
        <div class="btnrow">
          <button class="btn secondary" id="copyBtn" type="button">Copia</button>
        </div>
      </article>

      <article class="card">
        <h2>Nota di sicurezza</h2>
        <p class="muted">
          LIGHT non certifica identità. Serve a produrre un riferimento pseudonimo coerente (HRR) per la catena fail-closed.
          Per casi ad alto rischio usa STRONG.
        </p>
        <div class="btnrow">
          <a class="btn secondary" href="./strong.html">Vai a STRONG</a>
        </div>
      </article>
    </section>
  </main>

  <footer class="wrap foot">
    <small>HERMETICUM B.C.E. S.r.l.</small>
  </footer>

<script>
  // Minimal local HRR generator (non-PII, deterministic-ish per session)
  function simpleHash(str) {
    let h = 2166136261;
    for (let i = 0; i < str.length; i++) {
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return ("00000000" + (h >>> 0).toString(16)).slice(-8);
  }

  const form = document.getElementById("lightForm");
  const out = document.getElementById("out");
  const copyBtn = document.getElementById("copyBtn");

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const payload = {
      mode: "LIGHT",
      email_present: !!document.getElementById("email").value.trim(),
      country: document.getElementById("country").value.trim(),
      region: document.getElementById("region").value.trim(),
      city: document.getElementById("city").value.trim(),
      zone: document.getElementById("zone").value.trim(),
      ts_utc: new Date().toISOString()
    };

    const material = JSON.stringify(payload);
    const hrr = "HRR-L-" + simpleHash(material) + "-" + simpleHash(payload.country + payload.city + payload.zone);

    const receipt = {
      HRR: hrr,
      POLICY: "UE-first | GDPR-min | hash-only | fail-closed",
      NOTE: "Generated locally in browser. Not an identity proof.",
      PAYLOAD_MIN: payload
    };

    out.textContent = JSON.stringify(receipt, null, 2);
  });

  copyBtn.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(out.textContent);
      copyBtn.textContent = "Copiato";
      setTimeout(() => (copyBtn.textContent = "Copia"), 900);
    } catch {
      // no-op
    }
  });
</script>
</body>
</html>
