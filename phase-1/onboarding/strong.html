<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Onboarding STRONG | Fase 1 (ONLY) — HERMETICUM B.C.E.</title>
  <meta name="description" content="Onboarding STRONG: alto rischio. Attribuzione rafforzata, contatti minimi e dichiarazione d’uso." />
  <link rel="stylesheet" href="../../assets/css/main.css" />
</head>
<body>
  <header class="wrap">
    <nav class="nav">
      <a class="brand" href="../../">HERMETICUM - BLINDATA · COMPUTABILE · EVOLUTIVA</a>
      <div class="navlinks">
        <a href="../../standards/">Standard</a>
        <a href="../../research/">Ricerca</a>
        <a class="active" href="../">Fase 1</a>
        <a href="../../verify/">Verify</a>
        <a href="../../governance/">Governance</a>
        <a href="../../privacy/">Privacy</a>
      </div>
    </nav>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1>Onboarding STRONG</h1>
      <p class="lead">
        Profilo per casi ad <strong>alto rischio</strong>.
        Qui si aggiungono segnali di attribuzione rafforzata.
        Non è un IDP e non sostituisce eIDAS/CIE/SPID.
      </p>
      <div class="notice">
        <strong>Attenzione:</strong> inserisci solo dati minimi necessari al tuo caso d’uso.
        STRONG aumenta il perimetro privacy: usalo solo quando serve.
      </div>
    </section>

    <section class="grid">
      <article class="card">
        <h2>Dati (minimi ma rafforzati)</h2>

        <form id="strongForm">
          <label class="muted">Email (necessaria)</label>
          <input id="email" type="email" placeholder="email@dominio.eu" required />

          <label class="muted" style="margin-top:10px;">Telefono (necessario)</label>
          <input id="phone" type="tel" placeholder="+39 ..." required />

          <label class="muted" style="margin-top:10px;">Paese</label>
          <input id="country" type="text" placeholder="Italia" required />

          <label class="muted" style="margin-top:10px;">Regione</label>
          <input id="region" type="text" placeholder="Piemonte" required />

          <label class="muted" style="margin-top:10px;">Città</label>
          <input id="city" type="text" placeholder="Torino" required />

          <label class="muted" style="margin-top:10px;">Zona / Quartiere</label>
          <input id="zone" type="text" placeholder="Quartiere (senza via)" required />

          <label class="muted" style="margin-top:10px;">Motivo d’uso (necessario)</label>
          <select id="reason" required>
            <option value="">Seleziona…</option>
            <option value="public_admin">Pubblica Amministrazione / Istituzione</option>
            <option value="critical_infra">Infrastruttura critica / sicurezza</option>
            <option value="legal_audit">Audit legale / forense</option>
            <option value="enterprise_high_risk">Impresa (alto rischio)</option>
          </select>

          <label class="muted" style="margin-top:10px;">Dichiarazione (obbligatoria)</label>
          <div class="muted">
            <input id="consent" type="checkbox" required />
            <span>Confermo che STRONG è necessario e che inserirò solo dati minimi.</span>
          </div>

          <div class="btnrow" style="margin-top:14px;">
            <button class="btn" type="submit">Genera HRR STRONG (locale)</button>
            <a class="btn secondary" href="./light.html">Torna a LIGHT</a>
          </div>
        </form>
      </article>

      <article class="card">
        <h2>Output (locale)</h2>
        <p class="muted">
          Output generato nel browser. Copia/incolla o salva.
          STRONG produce un HRR “S” e una ricevuta più esplicita.
        </p>
        <pre id="out" class="codeblock">Compila il form e genera.</pre>
        <div class="btnrow">
          <button class="btn secondary" id="copyBtn" type="button">Copia</button>
        </div>
      </article>

      <article class="card">
        <h2>Nota di conformità</h2>
        <p class="muted">
          STRONG non è prova di identità civile. È un profilo di attribuzione rafforzata per catena fail-closed.
          Per identità regolamentata: eIDAS/CIE/SPID.
        </p>
        <div class="btnrow">
          <a class="btn secondary" href="../../governance/">Leggi Governance</a>
          <a class="btn secondary" href="../../privacy/">Leggi Privacy</a>
        </div>
      </article>
    </section>
  </main>

  <footer class="wrap foot">
    <small>HERMETICUM B.C.E. S.r.l.</small>
  </footer>

<script>
  function simpleHash(str) {
    let h = 2166136261;
    for (let i = 0; i < str.length; i++) {
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return ("00000000" + (h >>> 0).toString(16)).slice(-8);
  }

  const form = document.getElementById("strongForm");
  const out = document.getElementById("out");
  const copyBtn = document.getElementById("copyBtn");

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const payload = {
      mode: "STRONG",
      email_present: true,
      phone_present: true,
      country: document.getElementById("country").value.trim(),
      region: document.getElementById("region").value.trim(),
      city: document.getElementById("city").value.trim(),
      zone: document.getElementById("zone").value.trim(),
      reason: document.getElementById("reason").value,
      ts_utc: new Date().toISOString()
    };

    // we do NOT store raw email/phone in the bundle; we store presence + hashed contact signals
    const email = document.getElementById("email").value.trim().toLowerCase();
    const phone = document.getElementById("phone").value.trim();

    const contactSignals = {
      email_hash: simpleHash(email),
      phone_hash: simpleHash(phone)
    };

    const material = JSON.stringify(payload) + "|" + JSON.stringify(contactSignals);
    const hrr = "HRR-S-" + simpleHash(material) + "-" + simpleHash(payload.country + payload.city + payload.zone + payload.reason);

    const receipt = {
      HRR: hrr,
      POLICY: "UE-first | GDPR-min | hash-only | fail-closed",
      NOTE: "Generated locally in browser. Not an identity proof. Contact data not stored; only hashed signals included.",
      CONTACT_SIGNALS: contactSignals,
      PAYLOAD_MIN: payload
    };

    out.textContent = JSON.stringify(receipt, null, 2);
  });

  copyBtn.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(out.textContent);
      copyBtn.textContent = "Copiato";
      setTimeout(() => (copyBtn.textContent = "Copia"), 900);
    } catch {
      // no-op
    }
  });
</script>
</body>
</html>
